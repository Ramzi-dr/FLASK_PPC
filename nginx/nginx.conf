# Start a new server block
server {

    # Listen on HTTPS port 443 and enable SSL
    listen 443 ssl;

    # Domain name (for dev we use localhost)
    #server_name localhost;

    # Accept requests on your public IP (used in place of a domain)
    server_name 116.203.203.86;

    # Path to the SSL certificate (inside container)
    ssl_certificate /etc/nginx/certs/cert.pem;

    # Path to the private key (inside container)
    ssl_certificate_key /etc/nginx/certs/key.pem;

    # Let Nginx resolve upstream hostnames (e.g. host.docker.internal)
    resolver 127.0.0.11;

    # Define how to handle all requests to /
    location / {

        # ⚠️ TEMP: Flask is NOT in Docker yet, so we forward to the host machine
        # When Flask is dockerized, switch this line to:
        # proxy_pass http://flask:5000;

        # TEMP: Flask is running on the host, and you're on Linux
        proxy_pass http://172.17.0.1:5000;


        # Preserve the original host header
        proxy_set_header Host $host;

        # Forward client IP
        proxy_set_header X-Real-IP $remote_addr;

        # Forward client IP chain (e.g. if behind multiple proxies)
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
